# Story 1.4: Terminal Output Parsing

## Goal

Watch terminal stdout for Claude Code patterns: file writes, session IDs, token/cost info. Use this to trigger preview refreshes and update the status bar.

## Dependencies

- Story 1.3 (terminal integration)

## Files to Create/Edit

```
src/main/terminal-parser.ts              # Parse Claude Code output patterns
src/main/ipc.ts                          # Update: add parsed event channels
src/renderer/components/status-bar.tsx   # Update: show live session/cost/tokens
src/shared/types.ts                      # Update: parsed event types
```

## Patterns to Detect

```
# File write (triggers preview refresh)
Pattern: "Write" or "Edit" tool output containing a file path
Extract: file path (especially content/ paths)

# Session ID
Pattern: "Session: abc123" or similar in Claude's output
Extract: session ID string

# Token/Cost (from result messages)
Pattern: token count and cost in Claude's completion output
Extract: token count, cost in dollars
```

## Acceptance Criteria

- [ ] When Claude writes a file in `content/`, the app emits a `content:file-changed` event
- [ ] Status bar updates with session ID when detected
- [ ] Status bar updates with token count and cost when detected
- [ ] Parsing doesn't interfere with terminal rendering (no visible lag)
- [ ] Works with both `Write` and `Edit` tool outputs

## Notes

- This is best-effort parsing of ANSI terminal output â€” don't over-engineer
- Use regex on stripped (ANSI-removed) text
- The file-change event is what Phase 2 will use to trigger preview updates
- If parsing is unreliable, we can also use chokidar (file watcher) as a fallback
