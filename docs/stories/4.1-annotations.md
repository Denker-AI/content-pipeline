# Story 4.1: Annotations (Click-to-Comment)

## Goal

User can click on the preview to drop numbered pins and add comments. Comments accumulate in a sidebar. "Send to Claude" packages all comments as a revision prompt and types it into the terminal.

## Dependencies

- Story 2.2 (preview renderer)
- Story 1.3 (terminal integration — for typing into PTY)

## Files to Create/Edit

```
src/renderer/components/comment-overlay.tsx   # Click handler on preview
src/renderer/components/comment-pin.tsx       # Numbered pin marker
src/renderer/components/comment-sidebar.tsx   # Comment list + "Send to Claude" button
src/renderer/hooks/use-comments.ts           # Comment CRUD state
src/shared/types.ts                          # Update: comment types
```

## Flow

1. User clicks anywhere on preview → pin appears at position
2. Popover appears for typing comment text
3. Comment appears in sidebar with pin number
4. User can add multiple comments
5. Click "Send to Claude →" button:
   - Packages comments into a structured prompt
   - Types the prompt into the terminal PTY
6. Claude revises the file → file watcher triggers → preview updates
7. User can resolve individual comments

## Comment Prompt Format

```
Revise content/newsletters/2026-02/email.html:
(1) Near "Denker Newsletter" heading: "make this headline bigger"
(2) Near CTA button: "change color to brand accent"
Apply changes following brand guidelines.
```

## Acceptance Criteria

- [ ] Clicking on preview drops a numbered pin
- [ ] Popover for typing comment text
- [ ] Comments listed in sidebar with pin numbers
- [ ] "Send to Claude" types revision prompt into terminal
- [ ] Comments can be individually resolved/deleted
- [ ] Pins are cleared when all comments are resolved
- [ ] Works for HTML content in iframe

## Notes

- Pin position is relative to the iframe content, not the window
- For iframe content, use postMessage to get click coordinates
- "Send to Claude" literally writes to the PTY — no API call
- Comments are ephemeral (in-memory only for now)
